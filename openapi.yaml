openapi: 3.0.3
info:
  title: Taopochta MCP JSON-RPC API
  version: 0.0.1
  description: |
    OpenAPI wrapper for Taopochta MCP endpoint.

    MCP is transported over JSON-RPC 2.0 via HTTP POST.
    Use `initialize`, `tools/list`, and `tools/call`.

servers:
  - url: http://127.0.0.1:3000
    description: Local
  - url: https://taopochta.ru
    description: Production

paths:
  /api/mcp:
    post:
      summary: MCP JSON-RPC endpoint
      description: |
        Accepts a JSON-RPC request object or batch array.
        `tools/call` requires bearer token.
      operationId: mcpRootPost
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/JsonRpcRequest'
                - type: array
                  items:
                    $ref: '#/components/schemas/JsonRpcRequest'
            examples:
              initialize:
                value:
                  jsonrpc: "2.0"
                  id: 1
                  method: initialize
                  params:
                    protocolVersion: "2025-03-26"
                    capabilities: {}
                    clientInfo:
                      name: "demo-client"
                      version: "1.0.0"
              toolsList:
                value:
                  jsonrpc: "2.0"
                  id: 2
                  method: tools/list
                  params: {}
              toolsCall:
                value:
                  jsonrpc: "2.0"
                  id: 3
                  method: tools/call
                  params:
                    name: create_order
                    arguments:
                      shipping_address_id: 11
                      shop_id: "73320976"
                      item_id: "966108131284"
                      quantity: 1
                      shipping_quote_id: "a654c86bea44456a837adca4539534bc"
                      pay_method: bsc
      responses:
        '200':
          description: JSON-RPC response
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/JsonRpcSuccess'
                  - $ref: '#/components/schemas/JsonRpcError'
                  - type: array
                    items:
                      oneOf:
                        - $ref: '#/components/schemas/JsonRpcSuccess'
                        - $ref: '#/components/schemas/JsonRpcError'
        '204':
          description: No content (notification)

  /api/mcp/rpc:
    post:
      summary: MCP JSON-RPC endpoint (alias)
      description: Same behavior as `/api/mcp`.
      operationId: mcpRpcPost
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/JsonRpcRequest'
                - type: array
                  items:
                    $ref: '#/components/schemas/JsonRpcRequest'
      responses:
        '200':
          description: JSON-RPC response
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/JsonRpcSuccess'
                  - $ref: '#/components/schemas/JsonRpcError'
                  - type: array
                    items:
                      oneOf:
                        - $ref: '#/components/schemas/JsonRpcSuccess'
                        - $ref: '#/components/schemas/JsonRpcError'
        '204':
          description: No content (notification)

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    JsonRpcId:
      oneOf:
        - type: string
        - type: number
        - type: 'null'

    JsonRpcRequest:
      type: object
      required: [jsonrpc, method]
      properties:
        jsonrpc:
          type: string
          enum: ["2.0"]
        id:
          $ref: '#/components/schemas/JsonRpcId'
        method:
          type: string
          enum:
            - initialize
            - notifications/initialized
            - ping
            - tools/list
            - tools/call
        params:
          type: object
          additionalProperties: true
      additionalProperties: false

    JsonRpcSuccess:
      type: object
      required: [jsonrpc, id, result]
      properties:
        jsonrpc:
          type: string
          enum: ["2.0"]
        id:
          $ref: '#/components/schemas/JsonRpcId'
        result:
          type: object
          additionalProperties: true
          description: |
            For `tools/call`, result is:
              {
                content: [{ type: "text", text: "..." }],
                structuredContent: { ...tool payload... },
                isError: false|true
              }

    JsonRpcError:
      type: object
      required: [jsonrpc, id, error]
      properties:
        jsonrpc:
          type: string
          enum: ["2.0"]
        id:
          oneOf:
            - $ref: '#/components/schemas/JsonRpcId'
            - type: 'null'
        error:
          type: object
          required: [code, message]
          properties:
            code:
              type: integer
              description: JSON-RPC or application error code
            message:
              type: string
            data:
              nullable: true

  examples:
    ToolsCallCreateEscrow:
      summary: tools/call -> create_escrow
      value:
        jsonrpc: "2.0"
        id: 10
        method: tools/call
        params:
          name: create_escrow
          arguments:
            order_no: "394f22d4a49d245e"
            token_symbol: "USDT"
            buyer_wallet: "0xYourBuyerWalletAddress"

